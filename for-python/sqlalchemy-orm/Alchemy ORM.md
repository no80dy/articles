### Установка SQLAlchemy для PostgreSQL

Для того, чтобы начать работать с БД через SQLAlchemy ORM, нужно установить несколько пакетов
```bash
pip install psycopg2
pip install sqlalchemy2
```

Пакет `psycopg2` - это драйвер для работы с PostgreSQL, а `sqlalchemy` - сама ORM.

### Настройка SQLAlchemy в проекте

Для начала нужно создать модуль `database.py`, который и будет отвечать за настройку работы с SQLAlchemy.

```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker


# Настройка конфигов для подключния к PostgreSQL
SQLALCHEMY_DATABASE_URL = "postgresql+psycopg2://user:password@postgresserver/db"

# Инициализация движка для SQLAlchemy
engine = create_engine(SQLALCHEMY_DATABASE_URL)

# Инициализация фабрики сессий для SQLAlchemy
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# Инициализация базового класса для моделей
Base = declarative_base()
```

Теперь поговорим о каждой части данного модуля подробнее

### Движок SQLAlchemy ORM

- За работу с движком SQLAlchemy отвечает переменная `engine`.
- `engine` в SQLAlchemy используется для установления соединения с базой данных и выполнения запросов к ней. 
- С помощью `engine` можно определить параметры подключения к базе данных, такие как тип базы данных, адрес сервера, порт, имя пользователя и пароль. 
- `engine` также предоставляет интерфейс для создания и управления сессиями, которые позволяют выполнять транзакции и сохранять изменения в базе данных. 
- Кроме того, `engine` может быть настроен для автоматического создания таблиц и связей между ними на основе определенных моделей данных. 
- Использование `engine` позволяет упростить работу с базой данных в приложении и обеспечить ее более эффективное использование.

### SessionLocal или фабрика сессий

- `SessionLocal` в SQLAlchemy используется для создания локальной сессии базы данных в приложении. 
- Каждый раз, когда приложение нуждается в выполнении операции с базой данных, оно может создать экземпляр `SessionLocal` и использовать его для выполнения запросов и транзакций. 
- `SessionLocal` обеспечивает безопасность и целостность данных, позволяя приложению работать с базой данных в рамках одной транзакции. 
- Кроме того, `SessionLocal` автоматически управляет соединениями с базой данных, что позволяет более эффективно использовать ресурсы сервера. 
- Использование `SessionLocal` в SQLAlchemy позволяет упростить работу с базой данных в приложении и обеспечить ее более эффективное использование.

### Сессия и фабрика сессий

- `Session` в SQLAlchemy представляет собой экземпляр сессии базы данных, который используется для выполнения операций с базой данных. 
- `sessionmaker`, с другой стороны, представляет собой класс-фабрику, который используется для создания экземпляров `Session`. 
- Таким образом, использование `sessionmaker` позволяет создавать множество экземпляров `Session` с одинаковыми настройками, что упрощает работу с базой данных в приложении. 
- Однако, использование `Session` напрямую позволяет более гибко управлять жизненным циклом сессии и транзакций, а также более точно контролировать соединения с базой данных. 
- В целом, `Session` и `sessionmaker` в SQLAlchemy являются взаимозаменяемыми, и выбор между ними зависит от конкретных потребностей приложения.

### Модели базы данных и таблицы

- Для того, чтобы упростить работу с базой данных через объекты классов, используется объект `Base`.
- Он предоставляет удобный способ определения таблиц и их свойств, используя объектно-ориентированный подход, что делает код более читабельным и понятным.
- `Base` создается с помощью вызова `declarative_base()` модуля `sqlalchemy.ext.declarative`.
- Модуль `sqlalchemy.ext.declarative` позволяет определять модели данных в виде классов Python, которые наследуются от базового класса `declarative_base()` и имеют атрибуты, соответствующие полям таблицы в базе данных.
- Кроме того, модуль `sqlalchemy.ext.declarative` предоставляет возможность автоматически создавать таблицы в базе данных на основе определенных моделей данных, а также выполнять миграции данных при изменении структуры таблиц.
- В целом, использование модуля `sqlalchemy.ext.declarative` в SQLAlchemy упрощает работу с базой данных и делает код более понятным и легким для поддержки.